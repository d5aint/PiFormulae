DISCLAIMER: As typical, this page will be a placeholder for half-baked recipes and/or code to do something useful. The intention is to return here and [`finish up`](https://www.fastcompany.com/3025757/why-you-can-never-finish-anything-and-how-to-finally-change-it) soon :) 

# Thinking about ARP... what is it, how do we use it and why is it relevant to the Raspberry Pi? 

You can think of ARP as ["where the rubber meets the road"](https://www.knowyourphrase.com/when-the-rubber-hits-the-road) in IP networks. Many people are aware that the Internet Protocol (IP) uses a system of IP addresses, routers and DNS to get packets moved from source to destination. Fewer are familiar with the fact that the "MAC address" is the address that matters for delivery! IP addresses are ephemeral; they can be, and often are, changed frequently. But the MAC address serves the role of a "permanent address", and is used in networks to determine which host computer/interface takes delivery of the data packet. This role as permanent address was established when it was decided that each and every Ethernet adapter would have a unique address embedded in the hardware during the manufacturing process.

Well, that was the theory at the time anyway :)   Since that time, it's been decided that our systems will be allowed to "override" that permanent hardware address. It's [quite easy to change the MAC address of an adapter](https://www.howtogeek.com/192173/how-and-why-to-change-your-mac-address-on-windows-linux-and-mac/), and there are even good reasons for doing so. 

ARP is a rather arcane protocol that has been [described](http://www.erg.abdn.ac.uk/users/gorry/course/inet-pages/arp.html), [delineated](https://www.tummy.com/articles/networking-basics-how-arp-works/) and [defined](https://en.wikipedia.org/wiki/Address_Resolution_Protocol) in numerous sources. The definitive specification is [RFC 826](http://www.ietf.org/rfc/rfc826.txt), and it serves the basis for much of the ARP-specific networking software that has been coded since about 1982. 

Oh... and don't get ARP confused with ARPA! ARPA was the Advanced Research Projects Agency, an agency of the US government that funded the development of the Internet! Yes, it's true... it was even called [ARPAnet](https://en.wikipedia.org/wiki/ARPANET) back in the day, and ARPA funded development of what would eventually become the TCP/IP networking protocol - the protocol that you're reading (and I'm writing) this page with. It was this Government funding which led [Al Gore to state that he "created" (not "invented") the Internet](https://www.snopes.com/fact-check/internet-of-lies/). At any rate, ARPA eventually morphed into DARPA (Defense Advanced Research Projects Agency), and adopted a more, uh... nefarious (?) agenda. However, it is interesting perhaps that initial developement of ARP was funded by ARPA :)

But I digress... It seems interesting (to me at least) that although the MAC address was developed with the notion that it would be a permanent address, designed with an 'irrevocably-encoded-in-hardware' mentality, that it is used in an even more ephemeral context than the IP address! I say this because MAC Addresses are stored in something called the "ARP cache" in your computer, and that cache **typically** "expires" and is deleted under software control every 60 seconds in many systems! This seems very odd to me, but I'll confess that there may be good reasons for such a short lifetime of which I'm unaware. 

## And at last, "Why is this relevant to a Raspberry Pi?"

What I do know is that the ARP cache's short lifetime can make certain chores more difficult; e.g. [finding my new Raspberry Pi's IP address on my local network](https://github.com/seamusdemora/PiFormulae/blob/master/FindMyPi.md). In this case, what I'm searching for on my network are any MAC addresses whose first three octets are `b8:27:eb`. These [three octets are known as the OUI](https://www.webopedia.com/TERM/O/OUI.html), and have been assigned to the Raspberry Pi organization. Consequently, all of their network interfaces begin with these three octets, and consequently since The Organization has not seen fit to do anything else to help their user base with this issue (admittedly an issue unique to "headless" Pis), they are the best clue we have for tracking these devices down so that we may connect to them. I couldn't understand why this was so difficult until I understood the workings of the ARP cache. With that in mind, my simple hack is simply this: **ping every address on my subnet to 'refresh' my ARP cache, and then use the `arp` utility to get MAC address that I can `grep` for the OUI octets; i.e. `arp -a | grep b8:27:eb`.** 

But it's all good... good in the sense of a learning opportunity. Along the way, I've discovered some details that will no doubt help with other yet-to-be-encountered problems. I've also found what seems to be a neat tool named [`arping`](https://en.wikipedia.org/wiki/Arping) (a clever [Portmanteau](https://en.wikipedia.org/wiki/Portmanteau) :) that I've added to my toolbox. Turns out there are two implementations, the [plain-vanilla `arping` in `iputils`](https://packages.debian.org/sid/iputils-arping), and [an improved `arping` from Thomas Habets](https://github.com/ThomasHabets/arping). This latter version of arping is available on Raspbian via `sudo apt-get install arping`, and on Mac via [Homebrew](https://brew.sh/). What to do with all of this new-found knowledge and technology? Hmmm... I'd like to do an improved version of my shell script, or perhaps even create a customised [Raspbian Lite](https://www.raspberrypi.org/downloads/raspbian/) distribution that placed its address into its neighbors ARP caches immediately after it booted up! Yeah... this could be done with a "gratuitous ARP" that was invoked during startup... that doesn't sound too hard, does it? Kinda' makes you wonder why The Organization hasn't done it already since they're rolling in cash :)  




